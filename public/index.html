<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1a73e8">
  <title>Resume Scoring</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

  <!-- Top App Bar -->
  <header class="top-app-bar">
    <div class="app-bar-inner">
      <div class="app-icon">
        <span class="material-symbols-rounded icon-filled">description</span>
      </div>
      <div>
        <div class="app-title">Resume Scoring</div>
        <div class="app-subtitle">AI-powered candidate evaluation</div>
      </div>
      <div class="app-bar-actions">
        <button id="shortcutsBtn" class="md-btn md-btn-text" title="Keyboard shortcuts (?)">
          <span class="material-symbols-rounded">keyboard</span>
        </button>
        <button id="themeToggle" class="md-btn md-btn-text" title="Toggle dark mode">
          <span class="material-symbols-rounded">dark_mode</span>
        </button>
        <button id="deployBtn" class="md-btn md-btn-tonal">
          <span class="material-symbols-rounded">rocket_launch</span>
          Deploy
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="two-column-layout">

      <!-- LEFT: Job Information Card -->
      <section>
        <div class="md-card md-card-elevated">
          <div class="md-card-header">
            <h2>
              <span class="material-symbols-rounded">work</span>
              Job Details
            </h2>
            <div class="template-actions">
              <button id="loadTemplateBtn" class="md-btn md-btn-text md-btn-sm" title="Load from saved templates">
                <span class="material-symbols-rounded">folder_open</span>
                Templates
              </button>
              <button id="saveTemplateBtn" class="md-btn md-btn-text md-btn-sm" title="Save current JD as template">
                <span class="material-symbols-rounded">bookmark_add</span>
                Save
              </button>
            </div>
          </div>
          <!-- Template dropdown -->
          <div id="templateDropdown" class="template-dropdown" style="display:none;">
            <div id="templateList" class="template-list"></div>
            <div id="templateEmpty" class="template-empty">No saved templates yet.</div>
          </div>
          <div class="md-card-body">
            <div class="md-text-field">
              <label for="jobTitle">Job Title</label>
              <input type="text" id="jobTitle" placeholder="e.g., Senior Software Engineer">
            </div>
            <div class="md-text-field">
              <div class="label-with-action">
                <label for="jobDescription">Job Description</label>
                <button type="button" id="generateJdBtn" class="md-btn md-btn-tonal md-btn-sm" disabled>
                  <span class="material-symbols-rounded">auto_awesome</span>
                  Generate with AI
                </button>
              </div>
              <textarea id="jobDescription"
                placeholder="Paste the full job description here, or enter a job title above and click 'Generate with AI'..."></textarea>
              <div class="helper-text">Include all key requirements for better scoring accuracy</div>
            </div>

            <!-- Scoring Criteria (Optional) -->
            <div class="criteria-section">
              <button type="button" id="toggleCriteria" class="criteria-toggle">
                <span class="material-symbols-rounded criteria-toggle-icon">expand_more</span>
                Scoring Criteria (Optional)
              </button>
              <div id="criteriaBody" class="criteria-body" style="display:none;">
                <div class="helper-text" style="margin-bottom:12px;">Define custom scoring criteria. If left empty, defaults will be used (Skills Match, Experience, Education, Culture Fit at 25% each).</div>
                <div id="criteriaList"></div>
                <button type="button" id="addCriterionBtn" class="md-btn md-btn-tonal" style="margin-top:8px;">
                  <span class="material-symbols-rounded">add</span>
                  Add Criterion
                </button>
                <div id="criteriaWeightInfo" class="helper-text" style="margin-top:8px;"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Upload Card -->
      <section>
        <div class="md-card md-card-elevated">
          <div class="md-card-header">
            <h2>
              <span class="material-symbols-rounded">upload_file</span>
              Upload Resumes
            </h2>
          </div>
          <div class="md-card-body">
            <div class="upload-area" id="dropArea">
              <span class="material-symbols-rounded upload-icon">cloud_upload</span>
              <h3>Select resume files</h3>
              <p class="hint">PDF, DOC, DOCX, TXT, HTML, RTF, ZIP &bull; Max 100 files</p>
              <input type="file" id="fileInput" multiple
                accept=".pdf,.doc,.docx,.txt,.html,.htm,.rtf,.zip" hidden>
              <button id="browseBtn" class="md-btn md-btn-tonal">
                <span class="material-symbols-rounded">folder_open</span>
                Browse Files
              </button>
            </div>

            <div id="fileList" class="file-list"></div>

            <button id="uploadBtn" class="md-btn md-btn-filled md-btn-wide" disabled>
              <span class="material-symbols-rounded">cloud_upload</span>
              Upload
            </button>
            <div id="uploadStatus" class="status-message"></div>
          </div>
        </div>

        <!-- Process Button -->
        <div class="process-area" style="margin-top: 16px;">
          <button id="processBtn" class="md-btn md-btn-filled md-fab-extended md-btn-wide md-btn-success" disabled>
            <span class="material-symbols-rounded">auto_awesome</span>
            Process with AI
          </button>
          <div id="processStatus" class="status-message"></div>
        </div>
      </section>

    </div>

    <!-- Results Section -->
    <section id="resultsSection" class="results-section" style="display:none;">
      <div class="section-header">
        <span class="material-symbols-rounded icon-filled">leaderboard</span>
        <h2>Candidate Scores</h2>
        <button id="exportCsvBtn" class="md-btn md-btn-tonal" style="display:none;">
          <span class="material-symbols-rounded">download</span>
          Export CSV
        </button>
      </div>
      <div id="filterToolbar" class="filter-toolbar" style="display:none;">
        <div class="filter-search">
          <span class="material-symbols-rounded">search</span>
          <input type="text" id="filterSearch" placeholder="Search by name or filename...">
        </div>
        <div class="filter-group">
          <label>Score:</label>
          <input type="number" id="filterScoreMin" placeholder="Min" min="0" max="100">
          <span class="filter-dash">&ndash;</span>
          <input type="number" id="filterScoreMax" placeholder="Max" min="0" max="100">
        </div>
        <div class="filter-group">
          <label>Tag:</label>
          <select id="filterTag">
            <option value="">All</option>
            <option value="shortlist">Shortlist</option>
            <option value="maybe">Maybe</option>
            <option value="reject">Reject</option>
            <option value="untagged">Untagged</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Sort:</label>
          <select id="filterSort">
            <option value="score-desc">Score &#8595;</option>
            <option value="score-asc">Score &#8593;</option>
            <option value="name-asc">Name A&#8594;Z</option>
            <option value="name-desc">Name Z&#8594;A</option>
          </select>
        </div>
        <button id="filterClear" class="md-btn md-btn-text md-btn-sm">Clear</button>
        <span id="filterCount" class="filter-count"></span>
      </div>
      <div id="resultsContainer" class="results-grid"></div>
      <div id="compareBar" class="compare-bar" style="display:none;">
        <span id="compareCount">0 selected</span>
        <div class="bulk-actions">
          <button class="md-btn md-btn-tonal md-btn-sm bulk-tag-btn" data-tag="shortlist">
            <span class="material-symbols-rounded">thumb_up</span> Shortlist
          </button>
          <button class="md-btn md-btn-tonal md-btn-sm bulk-tag-btn" data-tag="maybe">
            <span class="material-symbols-rounded">help</span> Maybe
          </button>
          <button class="md-btn md-btn-tonal md-btn-sm bulk-tag-btn" data-tag="reject">
            <span class="material-symbols-rounded">thumb_down</span> Reject
          </button>
        </div>
        <button id="compareBtn" class="md-btn md-btn-filled" disabled>
          <span class="material-symbols-rounded">compare_arrows</span>
          Compare
        </button>
        <button id="compareClearBtn" class="md-btn md-btn-text">Clear</button>
      </div>
    </section>

    <!-- History Section -->
    <section id="historySection" class="results-section" style="margin-top: 32px;">
      <div class="section-header">
        <span class="material-symbols-rounded icon-filled">history</span>
        <h2>Past Sessions</h2>
        <button id="refreshHistoryBtn" class="md-btn md-btn-text" title="Refresh">
          <span class="material-symbols-rounded">refresh</span>
        </button>
      </div>
      <div id="historyContainer" class="history-list"></div>
      <div id="historyEmpty" class="history-empty" style="display:none;">
        <span class="material-symbols-rounded" style="font-size:48px; color:var(--md-on-surface-variant);">folder_open</span>
        <p>No past sessions yet. Score some resumes to get started.</p>
      </div>
    </section>
  </main>

  <!-- Deploy Modal -->
  <div id="deployModal" class="modal-overlay">
    <div class="modal-card">
      <div class="modal-header">
        <span class="material-symbols-rounded" style="color: var(--md-primary); font-size: 28px;">rocket_launch</span>
        <h2>Deploy Application</h2>
        <button class="modal-close" id="deployModalClose" title="Close">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>

      <div class="modal-body">
        <!-- Target Type Selector -->
        <div class="md-segmented-btn" id="deployTargetSelector">
          <button class="active" data-target="local">
            <span class="material-symbols-rounded">computer</span>
            Local
          </button>
          <button data-target="external">
            <span class="material-symbols-rounded">dns</span>
            External
          </button>
          <button data-target="cloud">
            <span class="material-symbols-rounded">cloud</span>
            Cloud
          </button>
        </div>

        <!-- LOCAL form fields -->
        <div id="deployFormLocal" class="deploy-form-section visible">
          <div class="md-text-field">
            <label for="deployLocalPort">Port</label>
            <input type="number" id="deployLocalPort" placeholder="e.g., 3001" value="3001" min="1024" max="65535">
            <div class="helper-text">The local port to run the deployed instance on (1024-65535)</div>
          </div>
        </div>

        <!-- EXTERNAL form fields -->
        <div id="deployFormExternal" class="deploy-form-section">
          <div class="deploy-form-row">
            <div class="md-text-field">
              <label for="deployExtHost">Host / IP</label>
              <input type="text" id="deployExtHost" placeholder="e.g., 192.168.1.100">
            </div>
            <div class="md-text-field">
              <label for="deployExtPort">SSH Port</label>
              <input type="number" id="deployExtPort" placeholder="22" value="22">
            </div>
          </div>
          <div class="md-text-field">
            <label for="deployExtUsername">Username</label>
            <input type="text" id="deployExtUsername" placeholder="e.g., deploy">
          </div>
          <div class="md-text-field">
            <label for="deployExtPassword">Password or SSH Key</label>
            <textarea id="deployExtPassword" placeholder="Enter password or paste SSH private key" style="min-height: 80px;"></textarea>
            <div class="helper-text">For SSH keys, paste the full private key contents (-----BEGIN ... -----END ...)</div>
          </div>
          <div class="deploy-form-row">
            <div class="md-text-field">
              <label for="deployExtPath">Remote Path</label>
              <input type="text" id="deployExtPath" placeholder="e.g., /home/deploy/resume-scoring">
            </div>
            <div class="md-text-field">
              <label for="deployExtAppPort">App Port</label>
              <input type="number" id="deployExtAppPort" placeholder="3000" value="3000">
            </div>
          </div>
        </div>

        <!-- CLOUD form fields -->
        <div id="deployFormCloud" class="deploy-form-section">
          <div class="md-text-field">
            <label for="deployCloudHost">Cloud Host / IP</label>
            <input type="text" id="deployCloudHost" placeholder="e.g., ec2-xx-xx-xx-xx.compute.amazonaws.com">
            <div class="helper-text">AWS EC2, DigitalOcean Droplet, GCP VM, Azure VM, etc.</div>
          </div>
          <div class="deploy-form-row">
            <div class="md-text-field">
              <label for="deployCloudSSHPort">SSH Port</label>
              <input type="number" id="deployCloudSSHPort" placeholder="22" value="22">
            </div>
            <div class="md-text-field">
              <label for="deployCloudUsername">Username</label>
              <input type="text" id="deployCloudUsername" placeholder="e.g., ubuntu, ec2-user">
            </div>
          </div>
          <div class="md-text-field">
            <label for="deployCloudKey">SSH Private Key</label>
            <textarea id="deployCloudKey" placeholder="Paste SSH private key (-----BEGIN OPENSSH PRIVATE KEY-----...)" style="min-height: 100px;"></textarea>
            <div class="helper-text">Cloud providers typically use key-based authentication</div>
          </div>
          <div class="deploy-form-row">
            <div class="md-text-field">
              <label for="deployCloudPath">Remote Path</label>
              <input type="text" id="deployCloudPath" placeholder="e.g., /home/ubuntu/resume-scoring">
            </div>
            <div class="md-text-field">
              <label for="deployCloudAppPort">App Port</label>
              <input type="number" id="deployCloudAppPort" placeholder="3000" value="3000">
            </div>
          </div>
        </div>

        <!-- Deploy Log -->
        <div id="deployLog" class="deploy-log"></div>
      </div>

      <div class="modal-actions">
        <button id="deployCancelBtn" class="md-btn md-btn-text">Cancel</button>
        <button id="deploySubmitBtn" class="md-btn md-btn-filled">
          <span class="material-symbols-rounded">rocket_launch</span>
          Deploy
        </button>
      </div>
    </div>
  </div>

  <!-- Shortcuts Help Overlay -->
  <div id="shortcutsOverlay" class="shortcuts-overlay">
    <div class="shortcuts-card">
      <h3>
        <span class="material-symbols-rounded">keyboard</span>
        Keyboard Shortcuts
      </h3>
      <div class="shortcut-row">
        <span class="shortcut-action">Process with AI</span>
        <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">Enter</span></div>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-action">Browse files</span>
        <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">U</span></div>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-action">Save JD template</span>
        <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">S</span></div>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-action">Export CSV</span>
        <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">E</span></div>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-action">Show this help</span>
        <div class="shortcut-keys"><span class="shortcut-key">?</span></div>
      </div>
      <div class="shortcut-row">
        <span class="shortcut-action">Close dialog</span>
        <div class="shortcut-keys"><span class="shortcut-key">Esc</span></div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Confirm Dialog -->
  <div id="confirmOverlay" class="confirm-overlay">
    <div class="confirm-card">
      <div id="confirmMessage" class="confirm-message"></div>
      <div class="confirm-actions">
        <button id="confirmCancel" class="md-btn md-btn-text">Cancel</button>
        <button id="confirmOk" class="md-btn md-btn-filled">Confirm</button>
      </div>
    </div>
  </div>

  <script src="/js/auth.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
